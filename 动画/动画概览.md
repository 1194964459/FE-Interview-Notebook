# 动画

参考：
animation属性：https://www.runoob.com/cssref/css3-pr-animation.html

@keyframes规则：https://www.runoob.com/cssref/css3-pr-animation-keyframes.html

transition: https://www.cnblogs.com/xiaohuochai/p/5347930.html

深入浏览器理解CSS animations 和 transitions的性能问题 
https://github.com/XJ-Parker/notes/issues/1


## 实现动画的几种方式：
* CSS动画：
    * Transition
    * Animation
* Canvas
* SVG动画：使用 SVG 的`<animate>`元素
* JS直接操作样式，结合setInterval、requestAnimationFrame等；
* Web Animation API：JS 动画的标准 API，结合了 CSS 动画的性能和 JS 的控制能力。
* 动画库

## 动画如何优化？
* 优先使用 transform 和 opacity：在结合图层（合成层）使用时不会触发重绘重排，能提供更流畅的动画效果，并且可以利用 GPU 加速
    > CSS Transition，Animation，Web Animation API 这3种方式都可以使用transform属性
* 使用 CSS 的 will-change属性：提前告知浏览器即将发生哪些变化，触发GPU加速。如：`will-change: transform`

以下两项尽量少使用：
* 触发重绘的background-color、visibility，
* 触发重排：width、height

## 动画实践
background-image设置雪碧图，然后通过修改 background-position修改雪碧图位置。background-position 属性会触发重绘
```js
/* 1. 限制动画元素尺寸，减少重绘区域 */
.animated-bg {
  width: 100px;  /* 避免过大尺寸 */
  height: 100px;
  background: url(sprite.png) no-repeat;
  
  /* 2. 使用 will-change 提示浏览器优化 */
  will-change: background-position;
  
  /* 3. 优化动画时间曲线，减少视觉卡顿感 */
  animation: sprite-animation 0.5s steps(10) infinite;
}

@keyframes sprite-animation {
  from { background-position: 0 0; }
  to { background-position: -1000px 0; }
}
```

background-position 的替代方案：
1. 使用 transform: translate() 替代：`transform: translate(-100px, 0); 实现平移效果`
2. 将精灵图转为 WebP 动图或短视频


参考：
css3动画相比与JS动画更轻量，性能更好，更易于实现。animation相比 transtion 使用起来更为复杂，但也提供了更多的控制。

## CSS动画 与 JS 动画 
[CSS动画](https://developer.mozilla.org/zh-CN/docs/Web/CSS/CSS_animations)

JS动画最好借助[requestAnimationFrame](../前端性能优化/requestAnimationFrame_requestIdleCallback.md)，让JS实现的动画与浏览器渲染周期保持一致。


## animation 和 transition 对比：
animation 和 transition 是 CSS 中实现动画效果的两种核心技术。

1. transition（过渡）   
transition 用于实现元素从一个样式状态平滑过渡到另一个状态，需要触发条件（如鼠标悬停、JS 修改类名等）。只能定义开始和结束两个状态，适合简单的状态变化
```js
.box {
  width: 100px;
  height: 100px;
  background: blue;
  
  /* 定义过渡：属性 时长 缓动函数 延迟 */
  transition: width 0.3s ease 0.1s, background 0.3s ease;
}

/* 触发条件 */
.box:hover {
  width: 200px;
  background: red;
}
```

2. animation（动画）  
animation 是更强大的动画系统，通过 @keyframes 定义多个关键帧，可以实现复杂的多阶段动画，且无需触发条件即可自动播放。可循环播放、暂停/继续或反向播放，可以对动画进行更精细的时间控制（如不同阶段不同速度）

```js
/* 定义关键帧 */
@keyframes bounce {
  0% { transform: translateY(0); }
  50% { transform: translateY(-50px); }
  100% { transform: translateY(0); }
}

.box {
  width: 100px;
  height: 100px;
  background: green;
  
  /* 应用动画：名称 时长 缓动 延迟 次数 方向 */
  animation: bounce 1s ease-in-out 0.5s infinite alternate;
}
```

@keyframes 定义了动画的 "关键节点"，而 steps() 则定义了如何在这些节点之间 "跳跃"，而不是平滑过渡。

为什么需要 steps() 的 "跳跃" 效果？因为：平滑过渡反而会破坏视觉体验。

哪些适合跳跃？哪些适合平滑过渡？
* 动画由离散的独立帧组成（如精灵图、数字变化、状态切换），需要清晰的 "跳帧" 效果。
* 动画需要连续的平滑过渡（如位置移动、大小缩放、颜色渐变），追求自然流畅的视觉效果。




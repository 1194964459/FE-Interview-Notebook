# Redux 常用中间件及原理

**Redux 本身只能处理同步 Action**（因为 **Reducer 是纯函数，不能包含异步逻辑**）。如果需要支持异步操作，或者支持错误处理、日志监控，就需要中间件​！


Redux中，中间件就是放在就是在dispatch过程，在分发action进行拦截处理，**传入dispatch的通常是个函数**，依靠这个来实现！！

以redux-thunk为例
```js
// 异步 Action Creator（需配置 redux-thunk 中间件）
function fetchUser(userId) {
  // 返回函数，接收 dispatch 和 getState 作为参数
  return (dispatch) => {
    dispatch({ type: 'FETCH_USER_START' });
    // 异步请求
    fetch(`/api/users/${userId}`)
      .then(res => res.json())
      .then(user => {
        dispatch({ type: 'FETCH_USER_SUCCESS', payload: user });
      })
      .catch(error => {
        dispatch({ type: 'FETCH_USER_ERROR', payload: error });
      });
  };
}

// 触发异步 Action
store.dispatch(fetchUser(123));
```
​如果 dispatch 的参数是 “函数”，就自动调用这个函数，并传入 dispatch 和 getState 作为参数。


## 常见中间件
选择中间件时，需根据项目复杂度和团队技术栈决定：

* 小型项目/快速迭代：优先用 redux-thunk + redux-logger；
* 复杂异步流程：用 redux-saga 或 redux-observable；
* 状态持久化：必选 redux-persist；
* 减少样板代码：用 redux-actions。


## 用法
```js
const store = createStore(​
  reducer,​
  applyMiddleware(thunk, logger)​
);
```
有很多优秀的redux中间件，如：​
• redux-thunk：用于异步操作​
• redux-logger：用于日志记录​
上述的中间件都需要通过applyMiddlewares进行注册，作用是将所有的中间件组成一个数组，依次执行​，然后作为第二个参数传入到createStore中
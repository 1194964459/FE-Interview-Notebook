# ç±»ç»„ä»¶
ç‰¹ç‚¹ï¼š
* **ç»§æ‰¿è‡ª React.Component**ï¼šå¿…é¡»é€šè¿‡ extends å…³é”®å­—ç»§æ‰¿ï¼Œå¦åˆ™æ— æ³•ä½¿ç”¨ React æä¾›çš„åŠŸèƒ½ã€‚
* é€šè¿‡ **this.state ç®¡ç†çŠ¶æ€**ï¼šçŠ¶æ€**éœ€åœ¨ constructor ä¸­åˆå§‹åŒ–**ï¼Œé€šè¿‡ this.setState() æ›´æ–°ï¼ˆè‡ªåŠ¨è§¦å‘é‡æ¸²æŸ“ï¼‰ã€‚
* ç”Ÿå‘½å‘¨æœŸæ–¹æ³•ï¼šæä¾›å¦‚ ```componentDidMountï¼ˆæŒ‚è½½åï¼‰ã€componentDidUpdateï¼ˆæ›´æ–°åï¼‰ã€componentWillUnmountï¼ˆå¸è½½å‰ï¼‰```ç­‰æ–¹æ³•ï¼Œç”¨äºå¤„ç†å‰¯ä½œç”¨å’Œç»„ä»¶ç”Ÿå‘½å‘¨æœŸé€»è¾‘ã€‚
* **this ç»‘å®šé—®é¢˜**ï¼šç±»ä¸­çš„è‡ªå®šä¹‰æ–¹æ³•é»˜è®¤ä¸ç»‘å®š thisï¼Œ**éœ€é€šè¿‡ç®­å¤´å‡½æ•°æˆ– bind æ‰‹åŠ¨ç»‘å®šï¼Œå¦åˆ™è°ƒç”¨æ—¶ this ä¼šæŒ‡å‘ undefined**ã€‚
* props é€šè¿‡ this.props è®¿é—®ï¼šçˆ¶ç»„ä»¶ä¼ é€’çš„å±æ€§é€šè¿‡ this.props è·å–ï¼Œä¸”ä¸å¯ç›´æ¥ä¿®æ”¹ï¼ˆåªè¯»ï¼‰ã€‚

```js
import React from 'react';

// ç»§æ‰¿ React.Component
class ClassComponent extends React.Component {
  // åˆå§‹åŒ–çŠ¶æ€
  constructor(props) {
    super(props); // å¿…é¡»è°ƒç”¨ super ä¼ é€’ props

    // æ³•1ï¼šstate åˆå§‹åŒ–
    this.state = { 
        count: 0, // æ•°å­—ç±»å‹
        user: { name: 'Alice', age: 20 }, // å¯¹è±¡ç±»å‹
        list: [1, 2, 3] // æ•°ç»„ç±»å‹
     };
  }

  // æ³•2ï¼šstateçš„ç¬¬äºŒç§åˆå§‹åŒ–æ–¹å¼   
  // state = { count: 0 };

  // è‡ªå®šä¹‰æ–¹æ³•ï¼ˆéœ€ç»‘å®š this æˆ–ä½¿ç”¨ç®­å¤´å‡½æ•°ï¼‰
  handleClick = () => {
    // æ›´æ–°çŠ¶æ€
    this.setState({ count: this.state.count + 1 });
  };

  // ç”Ÿå‘½å‘¨æœŸæ–¹æ³•ï¼šç»„ä»¶æŒ‚è½½åæ‰§è¡Œ
  componentDidMount() {
    console.log('ç»„ä»¶å·²æŒ‚è½½');
  }

  // æ¸²æŸ“ JSX
  render() {
    return (
      <div>
        <p>Count: {this.state.count}</p>
        <button onClick={this.handleClick}>åŠ 1</button>
      </div>
    );
  }
}

export default ClassComponent;
```

## setState
è¯­æ³•æ ¼å¼ï¼š
```js
// ç¬¬ä¸€ä¸ªå‚æ•°ä¸º å¯¹è±¡
setState([newState, callback])  // callbackä¸­å¯è·å–åˆ°æ›´æ–°åçš„å€¼

// ç¬¬ä¸€ä¸ªå‚æ•°ä¸º å‡½æ•°
setState(prev => newState, [callback])
```

æ³¨æ„äº‹é¡¹ğŸ“¢ï¼š
1. å¿…é¡»é€šè¿‡ this.setState() æ–¹æ³•æ›´æ–°çŠ¶æ€(ç›´æ¥ä¿®æ”¹ this.state ä¸ä¼šè§¦å‘ç»„ä»¶é‡æ¸²æŸ“)
2. å¼‚æ­¥ 
    * å¦‚ä½•æ‹¿åˆ°æ›´æ–°åçš„å€¼å‘¢ï¼Ÿéœ€ä½¿ç”¨ç¬¬äºŒä¸ªå‚æ•°ï¼ˆå›è°ƒå‡½æ•°ï¼‰ï¼š
      ```js
      this.setState({ count: 1 }, () => {
        console.log('æ›´æ–°åçš„å€¼ï¼š', this.state.count); // æ­£ç¡®è·å–æœ€æ–°å€¼
      });
      ```

    * ä¾èµ–æ—§çŠ¶æ€æ›´æ–°ï¼ˆå‚æ•°æ˜¯å‡½æ•°ï¼‰

        React ä¼šå°†å¤šä¸ªè¿ç»­çš„ setState è°ƒç”¨æ‰¹é‡å¤„ç†ï¼ˆè€Œéç«‹å³æ‰§è¡Œï¼‰ï¼Œåˆå¹¶ååªè§¦å‘ä¸€æ¬¡ç»„ä»¶é‡æ¸²æŸ“ï¼Œä»¥æ­¤ä¼˜åŒ–æ€§èƒ½ã€‚

      ç¤ºä¾‹ï¼šè¿ç»­è°ƒç”¨3æ¬¡setState
      ```js
      // é”™è¯¯ï¼šå¯¹è±¡å¼æ›´æ–°å¯èƒ½å› æ‰¹é‡å¤„ç†å¯¼è‡´åªåŠ  1ï¼ˆè€Œé 2ï¼‰
      this.setState({ count: this.state.count + 1 });
      this.setState({ count: this.state.count + 1 });

      // æ­£ç¡®ï¼šå‡½æ•°å¼æ›´æ–°ï¼Œé€šè¿‡ prevState æ‹¿åˆ°æœ€æ–°å€¼ï¼Œç¡®ä¿é€»è¾‘åˆå¹¶
      this.setState(prevState => ({ count: prevState.count + 1 }));
      this.setState(prevState => ({ count: prevState.count + 1 }));
      // åˆå¹¶å count æœ€ç»ˆåŠ  2ï¼ˆä¸¤æ¬¡æ›´æ–°é€»è¾‘ç”Ÿæ•ˆï¼‰
      ```

3. è‡ªåŠ¨åˆå¹¶çŠ¶æ€ï¼š   
æ³¨æ„ï¼šè‡ªåŠ¨åˆå¹¶çš„ä»…ä»…æ˜¯é¡¶å±‚å±æ€§ï¼Œæ·±å±‚å±æ€§ä¸ä¼šè‡ªåŠ¨åˆå¹¶ï¼ˆç›´æ¥è¦†ç›–ï¼‰    

ç¤ºä¾‹ï¼šå‡è®¾ç»„ä»¶åˆå§‹çŠ¶æ€ä¸º { name: "Alice", age: 20, info: { city: "Beijing" } }ï¼š
```js
// 1. è¿ç»­è°ƒç”¨å¯¹è±¡å¼ setState
this.setState({ age: 21 }); // åªæ›´æ–° age
this.setState({ name: "Alicia" }); // åªæ›´æ–° name

// React åˆå¹¶åï¼Œæœ€ç»ˆçŠ¶æ€ä¸ºï¼š
// { name: "Alicia", age: 21, info: { city: "Beijing" } }ï¼ˆæµ…åˆå¹¶é¡¶å±‚å±æ€§ï¼‰

// 2. æ³¨æ„ï¼šæ·±å±‚å±æ€§ä¸ä¼šè‡ªåŠ¨åˆå¹¶
this.setState({ info: { job: "Engineer" } }); 
// åˆå¹¶å info ä¼šè¢«è¦†ç›–ï¼Œå˜ä¸º { job: "Engineer" }ï¼ˆåŸ city ä¸¢å¤±ï¼‰
```

## setStateä½¿ç”¨æ—¶éœ€æ³¨æ„ï¼š
å‚è€ƒï¼š[æ¸²æŸ“ä¸å‰¯ä½œç”¨ è¯¦ç»†åŒºåˆ†ä¸‹](./3.1__å‰¯ä½œç”¨.md)

React ç»„ä»¶çš„åŸåˆ™ï¼šæ¸²æŸ“ä¸å‰¯ä½œç”¨åˆ†ç¦»ï¼

setStateæ˜¯å‰¯ä½œç”¨ï¼Œåº”è¯¥é¿å…åœ¨æ¸²æŸ“ä¸­æ‰§è¡Œã€‚å¦‚ï¼šgetDerivedStateFromProps â†’ shouldComponentUpdate â†’ render

* **é¿å…åœ¨ render ä¸­è°ƒç”¨ setStateï¼Œä¼šå¯¼è‡´æ— é™å¾ªç¯**ï¼š```render â†’ setState â†’ è§¦å‘é‡æ¸²æŸ“ â†’ å†æ¬¡ render```ã€‚
* **ä¸å…è®¸åœ¨çº¯å‡½æ•°ï¼ˆæ— å‰¯ä½œç”¨ï¼‰ä¸­ä½¿ç”¨setState****ï¼šå¦‚getDerivedStateFromPropsã€shouldComponentUpdateï¼ŒsetStateä¼šç ´åå™¨çº¯æ€§ã€‚**
* æ¨èåœ¨å‰¯ä½œç”¨ç”Ÿå‘½å‘¨æœŸä¸­ä½¿ç”¨ï¼šcomponentDidMountã€componentDidUpdateï¼Œä½†éœ€æ³¨æ„æ·»åŠ æ¡ä»¶åˆ¤æ–­é¿å…æ— é™å¾ªç¯ã€‚

## æ€§èƒ½ä¼˜åŒ–
é€šè¿‡ shouldComponentUpdate æˆ– React.PureComponent


## å‰¯ä½œç”¨ï¼š
ä½¿ç”¨ç”Ÿå‘½å‘¨æœŸæ–¹æ³•ï¼ˆcomponentDidMount ç­‰ï¼‰


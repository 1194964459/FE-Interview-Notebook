# Diff
协调算法中 专门负责计算新旧节点的差异。

Diff 的执行逻辑基于以下优化假设（保证时间复杂度从 O(n³) 降至 O(n)，n 为节点数））：
* 同层对比：只比较同一层级的节点，不跨层级复用 DOM；
* 类型优先：若节点类型（如 div→p）变化，直接销毁旧节点并重建；
* key 唯一性：通过 key 标识子节点的稳定性，避免不必要的重渲染（如列表排序时复用 DOM）。

### Diff算法过程如下：  
**1. 对比根节点类型**
* 如果根节点类型不同（如```<div> 变为 <span>```）：
React 会直接销毁旧树（卸载所有旧节点），并重建新树（挂载新节点）。

* 如果根节点类型相同：
React 会**保留根节点的 DOM 实例，仅更新其属性**（如 className、style 等），然后递归对比其子节点。

**2. 对比同类型元素的属性**  
对比并更新元素的属性（如 id、className、事件监听等），复用现有 DOM 节点。

**3. 对比列表子节点（核心优化点）**
* 每个列表项用 唯一且稳定的 key来标识，避免使用索引（index）作为 key（索引会随列表变化而变化，失去优化意义）。
* key 仅在当前列表中需要唯一，不影响其他列表。

**4. 递归对比子节点**  
处理完根节点和列表后，React 会递归对比所有子节点，重复上述过程（```类型检查、属性更新、列表 key 对比```），直到遍历完整个虚拟 DOM 树。
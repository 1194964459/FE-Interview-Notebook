# React中捕获异常

**1. 错误边界（Error Boundary）**：
捕获子组件树的渲染错误，防止错误导致整个应用崩溃，并展示备用 UI。

它通过两个**生命周期方法**实现：
* static getDerivedStateFromError(error)：渲染备用 UI
* componentDidCatch(error, errorInfo)：记录错误信息

注意：
* 错误边界**只能捕获子组件的错误，无法捕获自身错误**
* 无法捕获**事件处理函数**（如onClick）中的错误
* 无法捕获**异步代码**（如setTimeout、Promise）中的错误
* 函数组件不能作为错误边界（**需用类组件实现**）

```js
// 错误边界组件
class ErrorBoundary extends React.Component {
  state = { hasError: false, error: null };

  // 发生错误时更新状态，渲染备用UI
  static getDerivedStateFromError(error) {
    return { hasError: true, error };
  }

  // 记录错误日志
  componentDidCatch(error, errorInfo) {
    console.error("捕获到错误:", error, errorInfo);
    // 可以在这里将错误发送到服务端
    // logErrorToService(error, errorInfo);
  }

  render() {
    if (this.state.hasError) {
      // 自定义备用UI
      return this.props.fallback || <div>发生错误，请稍后再试</div>;
    }
    return this.props.children;
  }
}

// 使用错误边界
function App() {
  return (
    <ErrorBoundary fallback={<div>用户列表加载失败</div>}>
      <UserList />
    </ErrorBoundary>
  );
}

// 可能出错的子组件
function UserList() {
  // 模拟错误：如果没有用户数据则抛出错误
  if (!users.length) {
    throw new Error("用户数据为空");
  }
  return (
    <ul>
      {users.map(user => (
        <li key={user.id}>{user.name}</li>
      ))}
    </ul>
  );
}
```
**2. try/catch：捕获同步代码和事件处理中的错误**

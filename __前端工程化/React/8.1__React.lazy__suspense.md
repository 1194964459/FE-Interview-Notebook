# React.lazy 和 Suspense

## 一、React.lazy：异步懒加载组件
按需加载/懒加载：组件需要渲染时才**动态加载**对应的代码，从而减小初始加载的 bundle 体积。

React.lazy 接收一个函数，该函数**必须调用 import()** 并返回一个 Promise。React 会在 HeavyComponent **首次被渲染时，自动加载其对应的 chunk**。
```js
// 传统导入方式（会被打包到主文件中）
import HeavyComponent from './HeavyComponent';

// 代码分割方式（使用 React.lazy）
const HeavyComponent = React.lazy(() => import('./HeavyComponent'));
```

**React.lazy 必须配合 React.Suspense 组件**使用 

只能用于**默认导出**（default export）的组件，如果需要加载命名导出的组件，需要**先创建一个中间组件，将命名导出转为默认导出**：

```js
// 中间组件：将命名导出转为默认导出
export { NamedComponent } from './SomeComponent';
// 改为：
export default function WrappedComponent() {
  return <NamedComponent />;
}

// 然后在懒加载时导入
const LazyComponent = lazy(() => import('./WrappedComponent'));
```
常见场景：路由懒加载

## 二、Suspense
在等待异步操作完成时，显示备用内容（fallback），直到异步操作就绪后再渲染目标内容。

基本用法：Suspense 通过 **fallback 属性定义加载时显示的内容**，**包裹**需要**等待异步资源的组件**。若包裹多个组件，需要等所有组件加载完成后，才替换为实际内容。

```js
{/* 等待异步资源时显示 "加载中..." */}
    <Suspense fallback={<div>加载中...</div>}>
        {/* 需要异步加载的内容 */}
    <AsyncComponent />
</Suspense>
```

# 网站部署目录、域名

## 疑问❓：访问一个域名，其实访问的是服务器的根目录？
答：不完全准确！实际部署中，域名永远绑定 “**网站根目录**”，而非 “**服务器物理根目录**”。通常做法是：为每个域名创建一个独立的文件夹（如 /var/www/example-com），然后通过服务器配置将域名与这个特定文件夹绑定，这个文件夹就是该域名的 “网站根目录”。
```
server {
  server_name example.com;  # 域名
  root /var/www/example-com;  # 该域名对应的“网站根目录”（是服务器上的一个子文件夹，而非物理根目录 /）
}
```
此时访问 example.com，实际访问的是 /var/www/example-com，而非服务器的物理根目录 /。

### 同一服务器可绑定多个域名，对应不同的 “网站根目录”
一台服务器可以通过 “虚拟主机”（Virtual Host）配置，绑定多个域名，每个域名对应完全不同的 “网站根目录”。
例如：
* 域名 example.com → 对应 /var/www/example-com（网站 A 的文件）
* 域名 blog.example.com → 对应 /var/www/blog（网站 B 的文件）
* 域名 test.com → 对应 /home/user/test-site（网站 C 的文件）

### 项目可能部署在 域名的根目录，也有可能部署在其“子目录”，如果这样的话，前后端该如何配置呢？
如上，就是后端部署在根目录的情况！
* 用户访问 `https://example.com` → 服务器返回 /var/www/example-com/index.html。
* index.html 中 `<script src="/src/main.js"></script>` → 服务器解析为 /var/www/example-com/src/main.js，并返回该文件。
    注意：这里是以斜杠 / 开头的绝对路径，但准确来说是 “站点根目录相对路径”。PS：见下面详细的解释

不同的打包构建工具：
* Vite：
**设置 base 选项**：如果**项目部署在域名的根目录**，可设置 base: '/'；若**部署在子目录**，比如 `https://example.com/my-app/`，则设置 base: '/my-app/'。
```js
// vite.config.js
export default {
  base: '/my-app/',
  // 其他配置...
};
```
* Webpack：配置 output.publicPath，配置项设置资源的公共路径。如：图片、脚本、CSS等。

```js
module.exports = {
  output: {
    publicPath: '/my-app/', // 假设部署在 /my-app/ 子目录
    // 其他配置...
  },
};
```
这个路径会影响：
* 打包后 index.html 中引用的 `<script>`（JS 文件）、`<link>`（CSS 文件）的 src/href 路径；
* CSS 中通过 url() 引用的图片、字体等资源路径；
* JS 中通过 import 或 require 引入的图片、媒体等资源的路径（经 file-loader 或 url-loader 处理后）。


## html中的路径是如何解析的呢？
开发环境：
1. 基于本地开发服务器（如 Vite、Webpack-dev-server 等）打开
    * 绝对路径（**站点根目录相对路径**）
        * 以 / 开头，例如 /src/main.ts
        * 解析规则：以当前网站的根目录为起点。
        * 比如当前页面 URL 是 http://localhost:3000/pages/user/profile，则 /src/main.ts 会被解析为 http://localhost:3000/src/main.ts。

    * 相对路径
        * 不以 / 开头，例如 src/main.ts 或 ../lib/util.js
        * 解析规则：**以当前 HTML 文件所在的路径为起点**。
        * 比如 HTML 文件路径是 http://localhost:3000/pages/about.html，则 src/main.ts 会被解析为 http://localhost:3000/pages/src/main.ts（*显然不符合预期，所以实际开发中很少这样用*）。

2. 静态文件直接打开（不通过开发服务器）：浏览器会将 HTML 文件所在的目录作为基础目录来解析相对路径


生产环境：同开发环境下，基于本地开发服务器的情况。

## contentBase与publicPath
参考：[Vite详解](./Vite/Vite详解.md)

contentBase：告诉开发服务器（webpack-dev-server），从哪个目录读取未经过 Webpack 打包的静态资源（如直接放在 public/ 下的图片、HTML）。Webpack 4 及之前支持，Webpack 5 已用 static 替代
```js
// Webpack 4 配置
module.exports = {
  devServer: {
    contentBase: path.join(__dirname, 'public'), // 服务器从 public/ 目录读取静态资源
    port: 3000
  }
};
```

publicPath：定义打包后的资源在浏览器中访问的 URL 路径前缀（如 /dist/），影响资源的引用路径。
```js
module.exports = {
  output: {
    filename: 'bundle.js',
    path: path.join(__dirname, 'dist'), // 打包文件输出到本地 dist/ 目录
    publicPath: '/dist/' // 浏览器访问这些资源时的 URL 前缀
  }
};
```
# webpack 中的压缩
[webpack中针对不同类型文件的，分别有哪些压缩插件？](https://www.doubao.com/thread/wf3b8e0dafe250462)

## 一、压缩
* **JS代码压缩**​：```TerserPlugin```，最流行的JS压缩器，支持ES6。不需要单独安装，生产模式下自动启用！(webpack 5已内置的默认压缩工具)，压缩时选项：
    > 是否移除注释extractComments、多进程并行构建parallel、是否启用混淆（压缩时是否保持类、函数的名称）。

* **CSS代码压缩​**：```css-minimizer-webpack-plugin​```，删除冗余空格、代码、注释，属性简写等，基于cssnano（专业 CSS 压缩工具）。 需配合 ```MiniCssExtractPlugin```（提取 CSS 为单独文件）使用，适合所有 CSS/SCSS/Less 项目

* **Html文件代码压缩**​：```HtmlWebpackPlugin```，配置其 minify 属性。设置了minify，实际会使用另一个插件```html-minifier-terser​```
```js
module.exports = {​
    ...​
    plugin:[​
        new HtmlwebpackPlugin({​
            ...​
            minify:{​
                minifyCSS:false, // 是否压缩css​
                collapseWhitespace:false, // 是否折叠空格​
                removeComments:true // 是否移除注释​
            }​
        })​
    ]​
}​
```
* **文件大小压缩**​：```compression-webpack-plugin```，减少http传输过程中宽带的损坏。

* **图片压缩**：```image-webpack-loader```， 一般来说，图片文件大小是远远要比 js 或者 css 文件大的，所以图片压缩较为重要。
* **自定义字体压缩**：FontminPlugin



## 二、CSS处理 增强配置
```JS
const MiniCssExtractPlugin = require('mini-css-extract-plugin');
const CssMinimizerPlugin = require('css-minimizer-webpack-plugin');

module.exports = {
  module: {
    rules: [
      {
        test: /\.css$/,
        use: [
          MiniCssExtractPlugin.loader, // 生产环境提取CSS为单独文件
          'css-loader',
          'postcss-loader' // 自动添加浏览器前缀等
        ]
      },
      {
        test: /\.scss$/,
        use: [
          MiniCssExtractPlugin.loader,
          'css-loader',
          'sass-loader' // 处理Sass
        ]
      }
    ]
  },
  plugins: [
    new MiniCssExtractPlugin({
      filename: 'css/[name].[contenthash].css'
    })
  ],
  optimization: {
    minimizer: [
      '...', // 保留默认的JS压缩
      new CssMinimizerPlugin() // 压缩CSS
    ]
  }
};
```

## 三、html-loader、html-webpack-plugin、html-minifier-terser  这三个区分一下：
三者分别解决 webpack 处理 HTML 时的「资源解析」「文件生成」「代码压缩」三大核心问题。

* html-loader：是个加载器（loader），将 HTML 转换为 webpack 可识别的 JS模块。并**自动解析 HTML 中的资源路径**（如 ```<img src="xxx">、<link href="xxx">```），让这些资源能被 webpack 后续打包处理。
  > 简单说：它解决了「HTML 里引用的图片 / CSS，webpack 不认识、没法打包」的问题。
```js
// webpack.config.js
module.exports = {
  module: {
    rules: [
      {
        test: /\.html$/, // 匹配所有 .html 文件
        use: {
          loader: 'html-loader',
          options: {
            // 可选：自定义需要解析的属性（比如解析 data-src 用于懒加载）
            attributes: {
              list: [
                { tag: 'img', attribute: 'src', type: 'src' }, // 默认
                { tag: 'img', attribute: 'data-src', type: 'src' }, // 新增解析 data-src
                { tag: 'link', attribute: 'href', type: 'src' }, // 默认（解析 CSS 链接）
              ]
            },
            // 可选：是否压缩 HTML（通常交给 html-minifier-terser 做，这里暂关闭）
            minimize: false 
          }
        }
      },
      // 配合处理解析出的资源（如图片）
      {
        test: /\.(png|jpe?g|gif)$/,
        type: 'asset/resource', // webpack 5 内置，替代旧的 file-loader
        generator: {
          filename: 'img/[name].[contenthash:8][ext]' // 打包后图片的输出路径
        }
      }
    ]
  }
};
```

项目中使用：

在 JS 文件中直接引入 HTML，html-loader 会自动解析其中的资源：

```js
// src/index.js
import template from './index.html'; // 引入 HTML 文件（经 html-loader 处理）

// 将 HTML 插入页面
document.body.innerHTML = template;
```

* html-webpack-plugin：手动创建 HTML，并手动引入打包后的 JS/CSS，每次打包后文件名变了还要改路径」的问题。
* html-minifier-terser：压缩 HTML 代码。移除 HTML 中的空格、注释、空标签，合并属性等
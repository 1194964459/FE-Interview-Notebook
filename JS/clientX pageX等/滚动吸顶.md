# 滚动吸顶
参考：https://github.com/ly2011/blog/issues/169

1. [IntersectionObserver](../JS/clientX%20pageX等/IntersectionObserver.md)，设置个1px高的观察元素，当元素离开视口时，触发吸顶；元素重新进入视口时，取消吸顶。

2. [粘性布局](../CSS/position.md)，兼容性不好，但很丝滑

3. 获取元素到文档顶部的初始距离，监听scroll事件，若`滚动距离scrollTop >= 初始距离`，设置 position: fixed。初始距离有2种获取方案：
    * 基于`el.offsetTop`
    * 基于`getBoundingClientRect().top + document.body.scrollTop`


# 基于scroll事件的吸顶方案
实现思路：
* 记录元素初始位置：获取元素到文档顶部的初始距离（offsetTop 或 `getBoundingClientRect()`），也称为“阈值”；
* 监听滚动事件：实时获取页面滚动距离（scrollTop）；
* 判断并切换样式：当`滚动距离 ≥ 元素初始距离`时，设置 position: fixed 固定在顶部；否则恢复默认定位。

这种方案兼容所有浏览器，不过需注意：
1. 当元素吸顶后，它会脱离文档流，可能会导致其下方内容的布局问题。因此，需要给该元素下方的元素添加一个padding-top或margin-top，其值等于吸顶元素的高度，以确保内容不会被遮挡。
2. offsetTop可能会因为 offsetParent 定位方式改变，而导致阈值不准。(参考：[offsetParent](./0.1_offsetParent.md))


## 如何获取元素到文档顶部的距离？
1. 利用 getBoundingClientRect() + 页面滚动距离（推荐）
getBoundingClientRect().top 能获取元素顶部到视口顶部的实时距离，加上页面当前滚动距离（scrollTop），即可得到元素到文档顶部的绝对距离。

适用场景：大多数场景，尤其是父级定位可能动态变化时

```js
function getElementToDocumentTop(element) {
  // 获取元素相对于视口顶部的距离
  const rect = element.getBoundingClientRect();
  // 获取页面滚动的总距离（文档顶部到视口顶部的距离）
  const scrollTop = window.pageYOffset || document.documentElement.scrollTop || document.body.scrollTop;
  // 元素到文档顶部的距离 = 元素到视口顶部的距离 + 页面滚动距离
  return rect.top + scrollTop;
}

// 使用示例
const targetElement = document.getElementById('target');
console.log('元素到文档顶部的距离：', getElementToDocumentTop(targetElement) + 'px');
```

2. 递归累加 offsetTop（兼容复杂层级）
offsetTop 表示元素相对于其最近的已定位祖先元素的距离，通过递归遍历所有父级并累加 offsetTop，可得到元素到文档顶部的距离。

适用场景：需要兼容老旧浏览器，或明确父级定位稳定时

```js
function getOffset(obj, direction) {
    let offsetL = 0;
    let offsetT = 0;
    while (obj !== window.document.body && obj !== null) {
        offsetL += obj.offsetLeft;
        offsetT += obj.offsetTop;
        obj = obj.offsetParent;
    }
    if (direction === 'left') {
        return offsetL;
    } else {
        return offsetT;
    }
}
```




# 可视窗口

* 可视窗口：浏览器中实际显示网页的区域，不包含地址栏、工具栏等浏览器控件
* 文档（Document）：整个网页的完整内容，可能需要滚动查看

下面👇🏻提到的各种属性，`window.xx`适合所有现代浏览器，`document.xx`多半是为了兼容文档模式、盒模型之类的。参考：[文档模式](https://juejin.cn/post/6932769062909018125)

## 获取可视窗口尺寸
1. 可视窗口高度
    * 含滚动条：`window.innerHeight`
    * 不含滚动条：
        * 标准盒模型：document.documentElement.`clientHeight`
        * 怪异盒模型：ocument.body.clientHeight

2. 可视窗口宽度
    * 含滚动条：`window.innerWidth`，最常用。适合所有现代浏览器，以及IE9+。
    * 不含滚动条：
        * 标准盒模型：`document.documentElement.clientWidth`，兼容性：所有浏览器（含 IE6+）	
        * 怪异盒模型：`document.body.clientWidth`

```js
// 获取可视窗口宽度（兼容所有浏览器）
function getViewportWidth() {
  return window.innerWidth ||   
         document.documentElement.clientWidth || 
         document.body.clientWidth;
}

// 获取可视窗口高度（兼容所有浏览器）
function getViewportHeight() {
  return window.innerHeight || 
         document.documentElement.clientHeight || 
         document.body.clientHeight;
}

// 使用
console.log("可视窗口宽度：", getViewportWidth()); // 如 1920
console.log("可视窗口高度：", getViewportHeight()); // 如 1080
```

## 获取可视窗口的滚动位置
垂直滚动距离：即 可视窗口顶部 到 文档顶部 的距离

```js
// 获取垂直滚动距离（Y轴）
function getScrollTop() {
  return window.scrollY ||   // window.xx 属性的，是现代浏览器 推荐选项，兼容 IE9+	
         window.pageYOffset || 
         document.documentElement.scrollTop ||   // 下面👇🏻两项主要是为了兼容 IE6+，格式为document.xx.xx
         document.body.scrollTop || 
         0; // 兜底值，避免未滚动时返回 undefined
}

// 获取水平滚动距离（X轴）
function getScrollLeft() {
  return window.scrollX ||  
         window.pageXOffset || 
         document.documentElement.scrollLeft || 
         document.body.scrollLeft || 
         0;
}

// 使用：监听滚动事件，实时获取滚动位置
window.addEventListener('scroll', () => {
  console.log("垂直滚动距离：", getScrollTop()); // 如 500（已向上滚动500px）
  console.log("水平滚动距离：", getScrollLeft());
});
```

## 判断某个元素是否在可视窗口内？
参考：[图片懒加载，判断是否在视口内](../../常见手写题/8.0__图片懒加载.md)

1. offsetTop < clientHeight + scrollTop   
    注意：该方法不一定准，因为offsetTop 表示元素相对于最近的已定位祖先元素的顶部偏移，若没有已定位祖先，则相对于 `<body>`。 

    ```js
      // 元素距离"文档顶部"的距离 < 屏幕可视窗口高度 + 元素滚动的高度(即：浏览器窗口顶部 到 文档顶部之间的距离)
      element.`offsetTop` < document.documentElement.`clientHeight` + document.documentElement.`scrollTop`     
    ```

2. getBoundingClientRect：适合 IE5.5 + 及所有浏览器
参考：[getBoundingClientRect](./getBoundingClientRect.md)

3. IntersectionObserver：IE 不支持，现代浏览器支持良好  
参考：[IntersectionObserver详情](./IntersectionObserver.md)

注意：监听视口变化时，使用 debounce 优化性能

## 什么是滚动到底部？
要判断是否滚动到底部，通常需要检测用户的滚动行为，并比较当前页面的滚动位置（例如，scrollTop）与页面的总高度（scrollHeight）以及浏览器可视窗口的高度（clientHeight）。

当用户滚动页面直至其在屏幕上看到的可见区域的底部正好与页面的最底部内容对齐时，就实现了“滚动到底部”。

当`scrollTop === scrollHeight - clientHeight` 时，表示元素的内容已经滚动到底部。

也可通过IntersectionObserver实现

## 返回顶部功能：
将 document.documentElement.scrollTop 设为 0，页面会滚动到顶部。


# 滚动相关的各种现实问题

## 一、是否在可视窗口内？
参考：[是否在可视窗口内？](./可视窗口.md)
* 元素距离"文档顶部"的距离 < 屏幕可视窗口高度 + 页面滚动的高度(即：浏览器窗口顶部 到 文档顶部之间的距离)
    > el.offsetTop < window.innerHeight + scrollTop
* [getBoundingClientRect](./getBoundingClientRect.md)
* IntersectionObserver

## 二、图片懒加载
参考：[图片懒加载](../../常见手写题/8.0__图片懒加载.md)

* 浏览器原生 loading="lazy" 属性
* 剩余三种方案依赖于是否在可视窗口内？初始先设定data-src='default.png'，当检测到图片出现在窗口之后再补充src属性

## 三、滚动吸顶
参考：[滚动吸顶](./滚动吸顶.md)
* position：sticky
* IntersectionObserver
* 获取元素到文档顶部的初始距离，监听scroll事件，若`el.offsetTop >= 初始距离`，设置 position: fixed。初始距离有2种获取方案：
    * 基于`el.offsetTop`
    * 基于`getBoundingClientRect() + el.scrollTop`


## 四、是否滚动到底部？
* `scrollTop === scrollHeight - clientHeight`
* IntersectionObserver

用于实现“上拉加载”

## 五、返回顶部
* 将 document.documentElement.scrollTop 设为 0

## 上拉加载 与 下拉刷新
https://vue3js.cn/interview/JavaScript/pull_up_loading_pull_down_refresh.html#%E4%B8%80%E3%80%81%E5%89%8D%E8%A8%80


关于下拉刷新的原生实现，主要分成三步：

* 监听原生touchstart事件，记录其初始位置的值，e.touches[0].pageY；
* 监听原生touchmove事件，记录并计算**当前滑动的位置值与初始位置值的差值，大于0表示向下拉动**，并**借助CSS3的translateY属性使元素跟随手势向下滑动对应的差值**，同时也应设置一个允许滑动的最大值；
* 监听原生touchend事件，若此时元素滑动达到最大值，则触发callback，同时将translateY重设为0，元素回到初始位置
# Pinia
参考：[Vuex 详情](./8.0__Vuex.md)

Pinia 是 Vue.js 的官方状态管理库，是 Vuex 的继任者。

Pinia 简化了状态管理的流程，API 更简洁、TS 友好，同时支持 Vue2、Vue3，兼容性强

* Pinia 中没有 Mutation，直接通过 action 处理同步和异步操作
* TypeScript 友好：天生支持类型推断，无需额外的类型声明
* 没有单独的 Module 概念，每个 store 本身就是一个独立的模块，多个 store 间是隔离的。

需注意：getter、Action中若想访问this 或 当前store中的state啥的，不要用箭头函数


## 一、创建 Store 根实例
```js
import { createPinia } from 'pinia'

const pinia = createPinia()
const app = createApp(App)

app.use(pinia)
```

## 二、定义一个 Store： 
```
export const useCounterStore = defineStore(store名称, {
    state: () => ({
        <!-- 键值对... -->
        count: 0,
    }),

    <!-- 计算属性（类似 Vue 的 computed） -->
    getters: {
        键值对

        或省略键，直接是个函数
    },

    <!-- 方法：同步和异步操作，不要用箭头函数，不然不能方法 this（defineStore 创建的 store实例） -->
    actions: {
        increment() {
            this.count++
        },

        // 异步操作
        async incrementAsync() {
            await new Promise(resolve => setTimeout(resolve, 1000))
            this.increment()
        }
    }

})
```

## 三、 Vue组件中使用
```JS
import { useCounterStore } from './stores/counter'
const counterStore = useCounterStore()
```
### 访问：
* `counterStore.count`
* `counterStore.increment()`
不要解构，会失去响应性
```js
const { count, increment } = counterStore   // 错误的，❌ 失去响应性了
```

storeToRefs包装后，可解构响应式属性（仅适用于 state 和 getter）
```js
import { storeToRefs } from 'pinia'

const counterStore = useCounterStore()

// 解构响应式状态（仅适用于 state 和 getter）
const { count, doubleCount } = storeToRefs(counterStore)

// action 仍需通过 store 实例调用
counterStore.increment()
```
[Vuex 中如何访问 state？](./8.0__Vuex.md)


### 状态更新方式：
1. 直接修改：`counterStore.count++`
2. 批量更新：$patch，参数可以是个对象、函数
```js
counterStore.$patch((state) => {
  state.count++
  state.name = 'New Name'
})
``` 
3. 通过 action 更新（适合复杂逻辑或异步操作）：
```js
counterStore.increment()
```
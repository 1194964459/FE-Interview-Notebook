# Vue2 与 Vue3 的渲染函数
Vue 中的渲染函数是用来生成虚拟 DOM（VNode）的，是模版编译的最终产物，用起来比较灵活。

在 Vue 中，render 选项和 `<template> 模板`是两种互斥的视图描述方式：如果组件定义了 render 函数，Vue 会直接使用它生成虚拟 DOM，而忽略 `<template>` 中的内容。

Vue2 和 Vue3 中基于渲染函数来生成DOM的主要方式有：  
* Vue2：渲染函数是h()，在选项式API中通过render选项返回 h()  
* Vue3：渲染函数是createVNode函数
  * 选项式API中，通过render选项返回 createVNode()
  * setup函数，返回 createVNode()

vue3中，选项式、组合式可以混在一起使用。

## 1. Vue2 中的渲染函数：h()
通过 render 选项定义，核心是 **h 函数**（**createElement 的别名**）

```js
export default {
  data() {
    return { msg: 'Hello Vue 2' }
  },
  render(h) {
    // h(标签名/组件, 属性对象, 子节点数组)
    return h('div', { 
      class: 'container',
      on: { click: this.handleClick }
    }, [
      h('p', null, this.msg), // 子节点1：文本
      h(MyComponent, { props: { id: 1 } }) // 子节点2：组件
    ])
  },
  methods: {
    handleClick() { /* ... */ }
  }
}
```
* h 函数创建 VNode，h 函数接收 3 个参数：标签名/组件、属性对象、子节点。
* 属性嵌套较深：事件需放在 on 对象中（如 on: { click: ... }），样式需放在 style 对象中。
* 直接绑定 this：函数内部通过 this 访问组件实例的 data、methods 等。

## 2. Vue3 中的渲染函数：createVNode函数   
选项式API中需要在render选项中返回；组合式API中 需在setup中返回。

特点如下：
* 属性扁平化（如事件，不需要嵌套在 on 对象中），
* TS 友好
* 与组合式API兼容：在 setup 中可直接返回渲染函数，无需依赖 this。

方式1：选项式中基于 render 选项的 
```js
import { createVNode, render } from 'vue'
import MyComponent from './MyComponent.vue'

export default {
  data() {
    return { msg: 'Hello Vue 3' }
  },
  render() {
    // createVNode(标签名/组件, 属性对象, 子节点)
    return createVNode('div', {
      class: 'container',
      onClick: this.handleClick // 事件直接以驼峰式绑定
    }, [
      createVNode('p', null, this.msg),
      createVNode(MyComponent, { id: 1 })
    ])
  },
  methods: {
    handleClick() { /* ... */ }
  }
}
```

方式2：基于setup返回一个渲染函数
```js
import { createVNode, ref } from 'vue';

export default {
  setup() {
    // 组合式API中的响应式数据
    const count = ref(0);
    const increment = () => count.value++;

    // 直接返回渲染函数
    return () => createVNode('div', { style: { padding: '20px' } }, [
      createVNode('h3', null, '组合式 API + render 函数'),
      createVNode('p', null, `计数: ${count.value}`),
      createVNode('button', { 
        onClick: increment,
        style: { padding: '8px 16px', marginTop: '10px' }
      }, '增加')
    ]);
  }
};
```